from django.shortcuts import render, redirect, HttpResponse
from WhatsafPortal.models import *
from django.contrib.auth.models import User
from django.contrib.auth import login as authLogin, login, authenticate, logout
from django.contrib import messages
from django.contrib.auth.hashers import check_password
import random
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.header import Header
from email.utils import formataddr
import smtplib
from selenium import webdriver
import time
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
import string
from WhatsafPortal.details import country_codes
from WhatsafBlogs.models import Blog

# mainDomain = "https://whatsaf.in"
mainDomain = "http://localhost:8000"
# C:\Users\Administrator\AppData\Local\Google\Chrome\User Data
# chromeLoc = "C:\\Users\\Administrator\\AppData\\Local\\Google\\Chrome\\User Data\\Profile {profNum}"
chromeLoc = "C:\\Users\\A\\AppData\\Local\\Google\\Chrome\\User Data\\Profile {profNum}"

def sendEmail(email, subject, message):
    msg = MIMEMultipart()
    msg['From'] = formataddr((str(Header('Whatsaf')), "no-reply@whatsaf.in"))
    msg['To'] = email
    msg["Subject"] = subject
    html = message
    msg.attach(MIMEText(html, 'html'))
    s = smtplib.SMTP('smtp.gmail.com', port=587)
    s.starttls()
    s.login("officials.whatsaf@gmail.com", "tmgfumuscnuftwmc")
    s.sendmail("no-reply@whatsaf.in", email, msg.as_string())
    s.quit()
    return None

def otpGen():
    otp = ""
    for OTP in range(6):
        otp += str(random.randint(1, 9))
    return otp

def userid():
    otp = ""
    for OTP in range(6):
        otp += str(random.randint(1, 9))
    return otp

# Casual Coding of Whatsaf
def index(request):
    if request.user.is_authenticated:
        if UserDetail.objects.get(User = request.user).Verification == False:
            dropUser = User.objects.get(username = request.user)
            dropUser.delete()
    return render(request, "index.html", {"faq" : FAQ.objects.all(), "blog" : Blog.objects.all()})

def error(request, exception):
    return render(request, "error.html")

def error500(request):
    return render(request, "error500.html")

def contact(request):
    if request.method == "POST":
        name = request.POST["name"]
        email = request.POST["email"]
        subject = request.POST["subject"]
        message = request.POST["message"]
        createContact = Contact(Name = name, Email = email, Subject = subject, Message = message)
        createContact.save()
        messages.success(request, "Thank you for contacting us. We will try to get you back ASAP...")
        return redirect("HomePage")
    return redirect("ErrorPage")

def signin(request):
    if request.user.is_authenticated:
        if UserDetail.objects.get(User = request.user).Verification == False:
            dropUser = User.objects.get(username = request.user)
            dropUser.delete()
    return render(request, "signin.html")

def signup(request):
    if request.user.is_authenticated:
        if UserDetail.objects.get(User = request.user).Verification == False:
            dropUser = User.objects.get(username = request.user)
            dropUser.delete()
    return render(request, "signup.html")

def register(request):
    if request.method == "POST":
        name = request.POST["name"]
        email = request.POST["email"]
        country = request.POST["country"]
        phone = request.POST["phone"]
        dob = request.POST["dob"]
        username = request.POST["username"]
        pwd1 = request.POST["pwd1"]
        pwd2 = request.POST["pwd2"]
        eotp = otpGen()
        potp = otpGen()
        if pwd1 != pwd2:
           messages.warning(request, "Passwords not matching. PLease try again.")
           return redirect("SignUP")
        if User.objects.filter(username=username).exists():
            messages.warning(request, "This username is already taken. Please try using our suggested username.")
            suggest = f"{name}{userid()}"
            rndm = ''.join([random.choice(string.ascii_letters) for n in range(12)])
            if User.objects.filter(username = suggest).exists():
                suggest = f"{name}{userid()}{rndm}"
            return render(request, "signup.html", {"username" : suggest})
        if User.objects.filter(email=email).exists():
            messages.warning(request, "This email is already in use. Please try using a different email.")
            return redirect("SignUP")
        creating_user = User.objects.create_user(username=username, password=pwd1)
        creating_user.email = email
        creating_user.first_name = name
        creating_user.save()
        authenticating = authenticate(username=username, password=pwd2)
        if authenticating is not None:
            authLogin(request, authenticating)
            creatingUserDet = UserDetail(User = request.user, Phone = phone, DOB = dob, OTP1 = eotp, OTP2 = potp, Country = country)
            creatingUserDet.save()
            messages.success(request, "Your account has been created successfully. Now please verify yourself.")
            sendEmail(email, "Verify Your Email", '''<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"><head>  <!--[if gte mso 9]><xml>  <o:OfficeDocumentSettings>    <o:AllowPNG/>    <o:PixelsPerInch>96</o:PixelsPerInch>  </o:OfficeDocumentSettings></xml><![endif]-->  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <meta name="x-apple-disable-message-reformatting">  <!--[if !mso]><!-->  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <!--<![endif]-->  <title></title>  <style type="text/css">    @media only screen and (min-width: 620px) {      .u-row {        width: 600px !important;      }      .u-row .u-col {        vertical-align: top;      }      .u-row .u-col-100 {        width: 600px !important;      }    }        @media (max-width: 620px) {      .u-row-container {        max-width: 100% !important;        padding-left: 0px !important;        padding-right: 0px !important;      }      .u-row .u-col {        min-width: 320px !important;        max-width: 100% !important;        display: block !important;      }      .u-row {        width: 100% !important;      }      .u-col {        width: 100% !important;      }      .u-col>div {        margin: 0 auto;      }    }        body {      margin: 0;      padding: 0;    }        table,    tr,    td {      vertical-align: top;      border-collapse: collapse;    }        p {      margin: 0;    }        .ie-container table,    .mso-container table {      table-layout: fixed;    }        * {      line-height: inherit;    }        a[x-apple-data-detectors='true'] {      color: inherit !important;      text-decoration: none !important;    }        table,    td {      color: #000000;    }        #u_body a {      color: #0000ee;      text-decoration: underline;    }        @media (max-width: 480px) {      #u_content_image_1 .v-src-width {        width: auto !important;      }      #u_content_image_1 .v-src-max-width {        max-width: 22% !important;      }    }  </style>  <!--[if !mso]><!-->  <link href="https://fonts.googleapis.com/css?family=Cabin:400,700" rel="stylesheet" type="text/css">  <!--<![endif]--></head><body class="clean-body u_body" style="margin: 0;padding: 0;-webkit-text-size-adjust: 100%;background-color: #f9f9f9;color: #000000">  <!--[if IE]><div class="ie-container"><![endif]-->  <!--[if mso]><div class="mso-container"><![endif]-->  <table id="u_body" style="border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;min-width: 320px;Margin: 0 auto;background-color: #f9f9f9;width:100%" cellpadding="0" cellspacing="0">    <tbody>      <tr style="vertical-align: top">        <td style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">          <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color: #f9f9f9;"><![endif]-->          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #ffffff;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table id="u_content_image_1" style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:20px;font-family:'Cabin',sans-serif;" align="left">                              <table width="100%" cellpadding="0" cellspacing="0" border="0">                                <tr>                                  <td style="padding-right: 0px;padding-left: 0px;" align="center">                                    <img align="center" border="0" src="https://whatsaf.in/static/img/Whatsaficon.png" alt="Image" title="Image" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 32%;max-width: 179.2px;"                                      width="179.2" class="v-src-width v-src-max-width" />                                  </td>                                </tr>                              </table>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #003399;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #003399;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:40px 10px 10px;font-family:'Cabin',sans-serif;" align="left">                              <table width="100%" cellpadding="0" cellspacing="0" border="0">                                <tr>                                  <td style="padding-right: 0px;padding-left: 0px;" align="center">                                    <img align="center" border="0" src="https://cdn.templates.unlayer.com/assets/1597218650916-xxxxc.png" alt="Image" title="Image" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 26%;max-width: 150.8px;"                                      width="150.8" class="v-src-width v-src-max-width" />                                  </td>                                </tr>                              </table>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:0px 10px 31px;font-family:'Cabin',sans-serif;" align="left">                              <div style="color: #e5eaf5; line-height: 140%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 140%;"><strong><span style="font-size: 30px; line-height: 42px;">VERIFY YOUR EMAIL</span></strong></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #ffffff;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:33px 55px;font-family:'Cabin',sans-serif;" align="left">                              <div style="line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 22px; line-height: 35.2px;">Hi, '''+name+'''</span></p>                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Thank you signing up to Whatsaf and showing your trust. Kindly enter the OTP (One Time Password) - '''+eotp+''' and verify your email address. Thank you for your kind cooperation! Have a great day ahead...</span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:33px 55px 60px;font-family:'Cabin',sans-serif;" align="left">                              <div style="line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Regards,</span></p>                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Team Whatsaf</span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #e5eaf5;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #e5eaf5;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:41px 55px 18px;font-family:'Cabin',sans-serif;" align="left">                              <div style="color: #003399; line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 20px; line-height: 32px;"><strong>You are receiving this email from official email address of Whatsaf (no-reply@whatsaf.in).</strong></span></p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;">whatsaf.in</span></p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;"><a rel="noopener" href="mailto:contact@whatsaf.in" target="_blank">contact@whatsaf.in</a></span></p>                                <p style="font-size: 14px; line-height: 160%;"> </p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;"><a rel="noopener" href="https://whatsaf.in/unsubscribe/'''+email+'''" target="_blank">Unsubscribe</a> | <a rel="noopener" href="https://whatsaf.in/blogs/" target="_blank">Blogs</a> | <a rel="noopener" href="https://whatsaf.in" target="_blank">Visit Website</a></span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:10px 10px 33px;font-family:'Cabin',sans-serif;" align="left">                              <div align="center">                                <div style="display: table; max-width:244px;">                                  <!--[if (mso)|(IE)]><table width="244" cellpadding="0" cellspacing="0" border="0"><tr><td style="border-collapse:collapse;" align="center"><table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-collapse:collapse; mso-table-lspace: 0pt;mso-table-rspace: 0pt; width:244px;"><tr><![endif]-->                                  <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                  <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                    <tbody>                                      <tr style="vertical-align: top">                                        <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                          <a href="" title="LinkedIn" target="_blank">                                            <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/linkedin.png" alt="LinkedIn" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                          </a>                                        </td>                                      </tr>                                    </tbody>                                  </table>                                  <!--[if (mso)|(IE)]></td><![endif]-->                                  <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                    <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                        <tbody>                                          <tr style="vertical-align: top">                                            <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                              <a href="" title="LinkedIn" target="_blank">                                                <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/youtube.png" alt="YouTube" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                              </a>                                            </td>                                          </tr>                                        </tbody>                                      </table>                                      <!--[if (mso)|(IE)]></td><![endif]-->                                      <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                  <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                    <tbody>                                      <tr style="vertical-align: top">                                        <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                          <a href="" title="LinkedIn" target="_blank">                                            <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/x.png" alt="X" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                          </a>                                        </td>                                      </tr>                                    </tbody>                                  </table>                                  <!--[if (mso)|(IE)]></td><![endif]-->                                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->                                </div>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <!--[if (mso)|(IE)]></td></tr></table><![endif]-->        </td>      </tr>    </tbody>  </table>  <!--[if mso]></div><![endif]-->  <!--[if IE]></div><![endif]--></body></html>''')
            # Sharing OTP via whatsapp
            try:
                message = f"""Hello {name}, Thank you for signing up! To ensure security, please verify your account by entering the OTP (One-Time Password) - {potp}. We appreciate your cooperation!! Have a great day ahead..."""
                options = webdriver.ChromeOptions()
                options.add_argument(f'--user-data-dir={chromeLoc.format(profNum = "30082006")}')
                wd = webdriver.Chrome(options=options)
                cc = country_codes[country]
                wd.get(f"https://web.whatsapp.com/send?phone={cc}{phone}&text={message}")
                time.sleep(10)
                wd.execute_script('document.getElementsByClassName("tvf2evcx oq44ahr5 lb5m6g5c svlsagor p2rjqpw5 epia9gcq")[0].click();')
                time.sleep(2)
                wd.close()
            except Exception as e:
                pass

            return redirect("Verification")
    return redirect("ErrorPage")

def verification(request):
    return render(request, "verify.html")

def verify(request):
    if request.method == "POST":
        eotp = request.POST["eotp"]
        potp = request.POST["potp"]
        user = User.objects.get(username = request.user)
        userdet = UserDetail.objects.get(User = user)
        if userdet.OTP1 == eotp and userdet.OTP2 == potp:
            userdet.Verification = True
            userdet.save()
            sendEmail(request.user.email, "Account Created", '''<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"><head>  <!--[if gte mso 9]><xml>  <o:OfficeDocumentSettings>    <o:AllowPNG/>    <o:PixelsPerInch>96</o:PixelsPerInch>  </o:OfficeDocumentSettings></xml><![endif]-->  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <meta name="x-apple-disable-message-reformatting">  <!--[if !mso]><!-->  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <!--<![endif]-->  <title></title>  <style type="text/css">    @media only screen and (min-width: 620px) {      .u-row {        width: 600px !important;      }      .u-row .u-col {        vertical-align: top;      }      .u-row .u-col-100 {        width: 600px !important;      }    }        @media (max-width: 620px) {      .u-row-container {        max-width: 100% !important;        padding-left: 0px !important;        padding-right: 0px !important;      }      .u-row .u-col {        min-width: 320px !important;        max-width: 100% !important;        display: block !important;      }      .u-row {        width: 100% !important;      }      .u-col {        width: 100% !important;      }      .u-col>div {        margin: 0 auto;      }    }        body {      margin: 0;      padding: 0;    }        table,    tr,    td {      vertical-align: top;      border-collapse: collapse;    }        p {      margin: 0;    }        .ie-container table,    .mso-container table {      table-layout: fixed;    }        * {      line-height: inherit;    }        a[x-apple-data-detectors='true'] {      color: inherit !important;      text-decoration: none !important;    }        table,    td {      color: #000000;    }        #u_body a {      color: #0000ee;      text-decoration: underline;    }        @media (max-width: 480px) {      #u_content_image_1 .v-src-width {        width: auto !important;      }      #u_content_image_1 .v-src-max-width {        max-width: 22% !important;      }    }  </style>  <!--[if !mso]><!-->  <link href="https://fonts.googleapis.com/css?family=Cabin:400,700" rel="stylesheet" type="text/css">  <!--<![endif]--></head><body class="clean-body u_body" style="margin: 0;padding: 0;-webkit-text-size-adjust: 100%;background-color: #f9f9f9;color: #000000">  <!--[if IE]><div class="ie-container"><![endif]-->  <!--[if mso]><div class="mso-container"><![endif]-->  <table id="u_body" style="border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;min-width: 320px;Margin: 0 auto;background-color: #f9f9f9;width:100%" cellpadding="0" cellspacing="0">    <tbody>      <tr style="vertical-align: top">        <td style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">          <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color: #f9f9f9;"><![endif]-->          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #ffffff;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table id="u_content_image_1" style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:20px;font-family:'Cabin',sans-serif;" align="left">                              <table width="100%" cellpadding="0" cellspacing="0" border="0">                                <tr>                                  <td style="padding-right: 0px;padding-left: 0px;" align="center">                                    <img align="center" border="0" src="https://whatsaf.in/static/img/Whatsaficon.png" alt="Image" title="Image" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 32%;max-width: 179.2px;"                                      width="179.2" class="v-src-width v-src-max-width" />                                  </td>                                </tr>                              </table>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #003399;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #003399;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:40px 10px 10px;font-family:'Cabin',sans-serif;" align="left">                              <table width="100%" cellpadding="0" cellspacing="0" border="0">                                <tr>                                  <td style="padding-right: 0px;padding-left: 0px;" align="center">                                    <img align="center" border="0" src="https://cdn.templates.unlayer.com/assets/1597218650916-xxxxc.png" alt="Image" title="Image" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 26%;max-width: 150.8px;"                                      width="150.8" class="v-src-width v-src-max-width" />                                  </td>                                </tr>                              </table>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:0px 10px 31px;font-family:'Cabin',sans-serif;" align="left">                              <div style="color: #e5eaf5; line-height: 140%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 140%;"><strong><span style="font-size: 30px; line-height: 42px;">THANKS FOR SIGNING UP!!</span></strong></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #ffffff;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:33px 55px;font-family:'Cabin',sans-serif;" align="left">                              <div style="line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 22px; line-height: 35.2px;">Welcome aboard! '''+request.user.first_name+'''</span></p>                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">We're thrilled you've joined us at Whatsaf. Your sign-up marks the beginning of an exciting journey together. We're here to provide top-notch service, assist you at every step, and keep you updated with the latest offerings and exclusive deals tailored just for you. If you need anything or have questions, feel free to reach out—we're here to make your experience exceptional.</span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:33px 55px 60px;font-family:'Cabin',sans-serif;" align="left">                              <div style="line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Regards,</span></p>                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Team Whatsaf</span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #e5eaf5;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #e5eaf5;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:41px 55px 18px;font-family:'Cabin',sans-serif;" align="left">                              <div style="color: #003399; line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 20px; line-height: 32px;"><strong>You are receiving this email from official email address of Whatsaf (no-reply@whatsaf.in).</strong></span></p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;">whatsaf.in</span></p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;"><a rel="noopener" href="mailto:contact@whatsaf.in" target="_blank">contact@whatsaf.in</a></span></p>                                <p style="font-size: 14px; line-height: 160%;"> </p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;"><a rel="noopener" href="https://whatsaf.in/unsubscribe/'''+request.user.email+'''" target="_blank">Unsubscribe</a> | <a rel="noopener" href="https://whatsaf.in/blogs/" target="_blank">Blogs</a> | <a rel="noopener" href="https://whatsaf.in" target="_blank">Visit Website</a></span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:10px 10px 33px;font-family:'Cabin',sans-serif;" align="left">                              <div align="center">                                <div style="display: table; max-width:244px;">                                  <!--[if (mso)|(IE)]><table width="244" cellpadding="0" cellspacing="0" border="0"><tr><td style="border-collapse:collapse;" align="center"><table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-collapse:collapse; mso-table-lspace: 0pt;mso-table-rspace: 0pt; width:244px;"><tr><![endif]-->                                  <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                  <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                    <tbody>                                      <tr style="vertical-align: top">                                        <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                          <a href="" title="LinkedIn" target="_blank">                                            <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/linkedin.png" alt="LinkedIn" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                          </a>                                        </td>                                      </tr>                                    </tbody>                                  </table>                                  <!--[if (mso)|(IE)]></td><![endif]-->                                  <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                    <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                        <tbody>                                          <tr style="vertical-align: top">                                            <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                              <a href="" title="LinkedIn" target="_blank">                                                <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/youtube.png" alt="YouTube" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                              </a>                                            </td>                                          </tr>                                        </tbody>                                      </table>                                      <!--[if (mso)|(IE)]></td><![endif]-->                                      <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                  <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                    <tbody>                                      <tr style="vertical-align: top">                                        <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                          <a href="" title="LinkedIn" target="_blank">                                            <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/x.png" alt="X" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                          </a>                                        </td>                                      </tr>                                    </tbody>                                  </table>                                  <!--[if (mso)|(IE)]></td><![endif]-->                                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->                                </div>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <!--[if (mso)|(IE)]></td></tr></table><![endif]-->        </td>      </tr>    </tbody>  </table>  <!--[if mso]></div><![endif]-->  <!--[if IE]></div><![endif]--></body></html>''')
            messages.success(request, "Congratulations! Your account has been verified...")
            return redirect("HomePage")
        else:
            messages.warning(request, "Incorrect OTP")
            return render(request, "verify.html")
    return redirect("ErrorPage")

def resend(request):
    if request.user.is_authenticated:
        userdet = UserDetail.objects.get(User = request.user)
        eotp = userdet.OTP1
        potp = userdet.OTP2

        sendEmail(request.user.email, "Resend OTP", '''<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"><head>  <!--[if gte mso 9]><xml>  <o:OfficeDocumentSettings>    <o:AllowPNG/>    <o:PixelsPerInch>96</o:PixelsPerInch>  </o:OfficeDocumentSettings></xml><![endif]-->  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <meta name="x-apple-disable-message-reformatting">  <!--[if !mso]><!-->  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <!--<![endif]-->  <title></title>  <style type="text/css">    @media only screen and (min-width: 620px) {      .u-row {        width: 600px !important;      }      .u-row .u-col {        vertical-align: top;      }      .u-row .u-col-100 {        width: 600px !important;      }    }        @media (max-width: 620px) {      .u-row-container {        max-width: 100% !important;        padding-left: 0px !important;        padding-right: 0px !important;      }      .u-row .u-col {        min-width: 320px !important;        max-width: 100% !important;        display: block !important;      }      .u-row {        width: 100% !important;      }      .u-col {        width: 100% !important;      }      .u-col>div {        margin: 0 auto;      }    }        body {      margin: 0;      padding: 0;    }        table,    tr,    td {      vertical-align: top;      border-collapse: collapse;    }        p {      margin: 0;    }        .ie-container table,    .mso-container table {      table-layout: fixed;    }        * {      line-height: inherit;    }        a[x-apple-data-detectors='true'] {      color: inherit !important;      text-decoration: none !important;    }        table,    td {      color: #000000;    }        #u_body a {      color: #0000ee;      text-decoration: underline;    }        @media (max-width: 480px) {      #u_content_image_1 .v-src-width {        width: auto !important;      }      #u_content_image_1 .v-src-max-width {        max-width: 22% !important;      }    }  </style>  <!--[if !mso]><!-->  <link href="https://fonts.googleapis.com/css?family=Cabin:400,700" rel="stylesheet" type="text/css">  <!--<![endif]--></head><body class="clean-body u_body" style="margin: 0;padding: 0;-webkit-text-size-adjust: 100%;background-color: #f9f9f9;color: #000000">  <!--[if IE]><div class="ie-container"><![endif]-->  <!--[if mso]><div class="mso-container"><![endif]-->  <table id="u_body" style="border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;min-width: 320px;Margin: 0 auto;background-color: #f9f9f9;width:100%" cellpadding="0" cellspacing="0">    <tbody>      <tr style="vertical-align: top">        <td style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">          <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color: #f9f9f9;"><![endif]-->          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #ffffff;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table id="u_content_image_1" style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:20px;font-family:'Cabin',sans-serif;" align="left">                              <table width="100%" cellpadding="0" cellspacing="0" border="0">                                <tr>                                  <td style="padding-right: 0px;padding-left: 0px;" align="center">                                    <img align="center" border="0" src="https://whatsaf.in/static/img/Whatsaficon.png" alt="Image" title="Image" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 32%;max-width: 179.2px;"                                      width="179.2" class="v-src-width v-src-max-width" />                                  </td>                                </tr>                              </table>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #003399;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #003399;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:40px 10px 10px;font-family:'Cabin',sans-serif;" align="left">                              <table width="100%" cellpadding="0" cellspacing="0" border="0">                                <tr>                                  <td style="padding-right: 0px;padding-left: 0px;" align="center">                                    <img align="center" border="0" src="https://cdn.templates.unlayer.com/assets/1597218650916-xxxxc.png" alt="Image" title="Image" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 26%;max-width: 150.8px;"                                      width="150.8" class="v-src-width v-src-max-width" />                                  </td>                                </tr>                              </table>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:0px 10px 31px;font-family:'Cabin',sans-serif;" align="left">                              <div style="color: #e5eaf5; line-height: 140%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 140%;"><strong><span style="font-size: 30px; line-height: 42px;">We resent you the OTP</span></strong></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #ffffff;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:33px 55px;font-family:'Cabin',sans-serif;" align="left">                              <div style="line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 22px; line-height: 35.2px;">Hi, '''+request.user.first_name+'''</span></p>                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Your are receiving this email becasue you requested for the OTP again. Kindly enter the OTP (One Time Password) - '''+eotp+''' and verify your email address. Thank you for your kind cooperation! Have a great day ahead...</span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:33px 55px 60px;font-family:'Cabin',sans-serif;" align="left">                              <div style="line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Regards,</span></p>                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Team Whatsaf</span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #e5eaf5;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #e5eaf5;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:41px 55px 18px;font-family:'Cabin',sans-serif;" align="left">                              <div style="color: #003399; line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 20px; line-height: 32px;"><strong>You are receiving this email from official email address of Whatsaf (no-reply@whatsaf.in).</strong></span></p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;">whatsaf.in</span></p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;"><a rel="noopener" href="mailto:contact@whatsaf.in" target="_blank">contact@whatsaf.in</a></span></p>                                <p style="font-size: 14px; line-height: 160%;"> </p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;"><a rel="noopener" href="https://whatsaf.in/unsubscribe/'''+request.user.email+'''" target="_blank">Unsubscribe</a> | <a rel="noopener" href="https://whatsaf.in/blogs/" target="_blank">Blogs</a> | <a rel="noopener" href="https://whatsaf.in" target="_blank">Visit Website</a></span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:10px 10px 33px;font-family:'Cabin',sans-serif;" align="left">                              <div align="center">                                <div style="display: table; max-width:244px;">                                  <!--[if (mso)|(IE)]><table width="244" cellpadding="0" cellspacing="0" border="0"><tr><td style="border-collapse:collapse;" align="center"><table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-collapse:collapse; mso-table-lspace: 0pt;mso-table-rspace: 0pt; width:244px;"><tr><![endif]-->                                  <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                  <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                    <tbody>                                      <tr style="vertical-align: top">                                        <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                          <a href="" title="LinkedIn" target="_blank">                                            <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/linkedin.png" alt="LinkedIn" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                          </a>                                        </td>                                      </tr>                                    </tbody>                                  </table>                                  <!--[if (mso)|(IE)]></td><![endif]-->                                  <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                    <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                        <tbody>                                          <tr style="vertical-align: top">                                            <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                              <a href="" title="LinkedIn" target="_blank">                                                <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/youtube.png" alt="YouTube" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                              </a>                                            </td>                                          </tr>                                        </tbody>                                      </table>                                      <!--[if (mso)|(IE)]></td><![endif]-->                                      <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                  <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                    <tbody>                                      <tr style="vertical-align: top">                                        <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                          <a href="" title="LinkedIn" target="_blank">                                            <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/x.png" alt="X" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                          </a>                                        </td>                                      </tr>                                    </tbody>                                  </table>                                  <!--[if (mso)|(IE)]></td><![endif]-->                                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->                                </div>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <!--[if (mso)|(IE)]></td></tr></table><![endif]-->        </td>      </tr>    </tbody>  </table>  <!--[if mso]></div><![endif]-->  <!--[if IE]></div><![endif]--></body></html>''')
            
        try:
            message = f"""Hello {request.user.first_name}, Thank you for signing up! To ensure security, please verify your account by entering the OTP (One-Time Password) - {potp}. We appreciate your cooperation!! Have a great day ahead..."""
            options = webdriver.ChromeOptions()
            options.add_argument(f'--user-data-dir={chromeLoc.format(profNum = "30082006")}')
            wd = webdriver.Chrome(options=options)
            cc = country_codes[userdet.Country]
            wd.get(f"https://web.whatsapp.com/send?phone={cc}{userdet.Phone}&text={message}")
            time.sleep(15)
            wd.execute_script('document.getElementsByClassName("tvf2evcx oq44ahr5 lb5m6g5c svlsagor p2rjqpw5 epia9gcq")[0].click();')
            time.sleep(2)
            wd.close()
        except Exception as e:
            pass
        return redirect("Verification")

    return redirect("ErrorPage")

def buy(request, slug):
    if request.user.is_authenticated:
        return render(request, "buy.html")
    messages.warning(request, "Please SignIN to proceed.")
    return redirect("SignIN")

def dashboard(request):
    if request.user.is_authenticated:
        if UserDetail.objects.get(User = request.user).Verification == False:
            dropUser = User.objects.get(username = request.user)
            dropUser.delete()
    return render(request, "dashboard.html", {"features" : Feature.objects.all()})

def signout(request):
    logout(request)
    messages.success(request, "You have been Signed Out.")
    return redirect("HomePage")

def forgotPass(request):
    return render(request, "forgot-password.html")

def login(request):
    if request.method == "POST":
        email = request.POST["email"]
        password = request.POST["password"]
        if User.objects.filter(email = email).exists() == False:
            messages.success(request, "Please SignUP first.")
            return redirect("SignUP")
        user = User.objects.get(email = email)
        authenticating = authenticate(username=user.username, password=password)
        if authenticating is not None:
            authLogin(request, authenticating)
            messages.success(request, f"You have successfully logged in, {request.user.first_name}.")
        else:
            messages.warning(request, "Please enter the fields correctly.")
            return redirect("SignIN")
        return redirect("Dashboard")
    return redirect("ErrorPage")

def resetPass(request):
    if request.method == "POST":
        email = request.POST["email"]
        if User.objects.filter(email = email).exists:
            otp = otpGen()
            userdet = UserDetail.objects.get(User = User.objects.get(email = email))
            userdet.OTP1 = otp
            userdet.save()
            sendEmail(email, "Update Password", f"<h6>We've received your request to reset your password for your Whatsaf account. To ensure the security of your account, here is your One-Time Password (OTP): {userdet.OTP1}</h6>")
            messages.success(request, "An email has been sent. Please checkout that.")
            return redirect("ForgotPassword")
    return redirect("ErrorPage")

def setPass(request):
    if request.method == "POST":
        otp = request.POST["otp"]
        pass1 = request.POST["pwd1"]
        pass2 = request.POST["pwd2"]
        userdet = UserDetail.objects.get(OTP1 = otp)
        if pass1 != pass2:
            return redirect("ForgotPassword")
        if userdet.OTP1 == otp:
            userdet.User.set_password(pass1)
            userdet.User.save()
            sendEmail(userdet.User.email, "Password Updated!", "<h6>Your password for your Whatsaf account has been successfully updated. Your account security is paramount to us, and we appreciate your proactive step in ensuring the safety of your information.</h6>")
            messages.success(request, "Your Password has been reset.")
            return redirect("HomePage")
    return redirect("ErrorPage")

def features(request):
    return render(request, "features.html", {"features" : Feature.objects.all(), "domain" : mainDomain})

def UserProfile(request):
    if request.user.is_authenticated:
        userdet = User.objects.get(username = request.user.username)
        userdet = UserDetail.objects.get(User = userdet)
        return render(request, "user-profile.html", {
            "image" : userdet.ProfilePhoto,
            "data" : userdet,
            "dob" : f"{userdet.DOB}"
        })
    else:
        return redirect("ErrorPage")

def EditUserProfile(request):
    if request.method == "POST":
        name = request.POST["name"]
        email = request.POST["email"]
        phone = request.POST["phone"]
        pwd = request.POST["password"]
        user_details = User.objects.get(username = request.user)
        dob = request.POST["dob"]
        if check_password(pwd, request.user.password):
            userdet = User.objects.get(username=request.user)
            userdet.first_name = name
            userdet.email = email
            userdet.save()
            userDet = User.objects.get(username=request.user)
            user_det = UserDetail.objects.get(User = userDet)
            user_det.DOB = dob
            user_det.Phone = phone
            user_det.save()
            if len(request.FILES) != 0:
                photo = request.FILES["photo"]
                profilephoto = UserDetail.objects.get(User = user_details)
                profilephoto.ProfilePhoto = photo
                profilephoto.save()
            sendEmail(request.user.email, "Profile Updated", '''<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"><head>  <!--[if gte mso 9]><xml>  <o:OfficeDocumentSettings>    <o:AllowPNG/>    <o:PixelsPerInch>96</o:PixelsPerInch>  </o:OfficeDocumentSettings></xml><![endif]-->  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <meta name="x-apple-disable-message-reformatting">  <!--[if !mso]><!-->  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <!--<![endif]-->  <title></title>  <style type="text/css">    @media only screen and (min-width: 620px) {      .u-row {        width: 600px !important;      }      .u-row .u-col {        vertical-align: top;      }      .u-row .u-col-100 {        width: 600px !important;      }    }        @media (max-width: 620px) {      .u-row-container {        max-width: 100% !important;        padding-left: 0px !important;        padding-right: 0px !important;      }      .u-row .u-col {        min-width: 320px !important;        max-width: 100% !important;        display: block !important;      }      .u-row {        width: 100% !important;      }      .u-col {        width: 100% !important;      }      .u-col>div {        margin: 0 auto;      }    }        body {      margin: 0;      padding: 0;    }        table,    tr,    td {      vertical-align: top;      border-collapse: collapse;    }        p {      margin: 0;    }        .ie-container table,    .mso-container table {      table-layout: fixed;    }        * {      line-height: inherit;    }        a[x-apple-data-detectors='true'] {      color: inherit !important;      text-decoration: none !important;    }        table,    td {      color: #000000;    }        #u_body a {      color: #0000ee;      text-decoration: underline;    }        @media (max-width: 480px) {      #u_content_image_1 .v-src-width {        width: auto !important;      }      #u_content_image_1 .v-src-max-width {        max-width: 22% !important;      }    }  </style>  <!--[if !mso]><!-->  <link href="https://fonts.googleapis.com/css?family=Cabin:400,700" rel="stylesheet" type="text/css">  <!--<![endif]--></head><body class="clean-body u_body" style="margin: 0;padding: 0;-webkit-text-size-adjust: 100%;background-color: #f9f9f9;color: #000000">  <!--[if IE]><div class="ie-container"><![endif]-->  <!--[if mso]><div class="mso-container"><![endif]-->  <table id="u_body" style="border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;min-width: 320px;Margin: 0 auto;background-color: #f9f9f9;width:100%" cellpadding="0" cellspacing="0">    <tbody>      <tr style="vertical-align: top">        <td style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">          <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color: #f9f9f9;"><![endif]-->          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #ffffff;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table id="u_content_image_1" style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:20px;font-family:'Cabin',sans-serif;" align="left">                              <table width="100%" cellpadding="0" cellspacing="0" border="0">                                <tr>                                  <td style="padding-right: 0px;padding-left: 0px;" align="center">                                    <img align="center" border="0" src="https://whatsaf.in/static/img/Whatsaficon.png" alt="Image" title="Image" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 32%;max-width: 179.2px;"                                      width="179.2" class="v-src-width v-src-max-width" />                                  </td>                                </tr>                              </table>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #003399;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #003399;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:40px 10px 10px;font-family:'Cabin',sans-serif;" align="left">                              <table width="100%" cellpadding="0" cellspacing="0" border="0">                                <tr>                                  <td style="padding-right: 0px;padding-left: 0px;" align="center">                                    <img align="center" border="0" src="https://cdn.templates.unlayer.com/assets/1597218650916-xxxxc.png" alt="Image" title="Image" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: inline-block !important;border: none;height: auto;float: none;width: 26%;max-width: 150.8px;"                                      width="150.8" class="v-src-width v-src-max-width" />                                  </td>                                </tr>                              </table>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:0px 10px 31px;font-family:'Cabin',sans-serif;" align="left">                              <div style="color: #e5eaf5; line-height: 140%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 140%;"><strong><span style="font-size: 30px; line-height: 42px;">YOUR PROFILE HAS BEEN UPDATED!!</span></strong></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #ffffff;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #ffffff;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:33px 55px;font-family:'Cabin',sans-serif;" align="left">                              <div style="line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 22px; line-height: 35.2px;">Hi, '''+request.user.first_name+'''</span></p>                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Congratulations on updating your profile with Whatsaf! Your proactive step in ensuring your details are current is appreciated and allows us to serve you better. Your updated profile ensures that we have the most accurate information to tailor our services specifically to your needs. This means you'll receive personalized updates, offers, and assistance that align perfectly with your preferences. We're dedicated to providing you with an exceptional experience, and your updated profile helps us in achieving that goal. Should you have any further updates or require assistance, don't hesitate to reach out. Thank you for choosing Whatsaf! We value your engagement and look forward to continuing to meet and exceed your expectations.</span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:33px 55px 60px;font-family:'Cabin',sans-serif;" align="left">                              <div style="line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Regards,</span></p>                                <p style="line-height: 160%; font-size: 14px;"><span style="font-size: 18px; line-height: 28.8px;">Team Whatsaf</span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <div class="u-row-container" style="padding: 0px;background-color: transparent">            <div class="u-row" style="Margin: 0 auto;min-width: 320px;max-width: 600px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: #e5eaf5;">              <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">                <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:600px;"><tr style="background-color: #e5eaf5;"><![endif]-->                <!--[if (mso)|(IE)]><td align="center" width="600" style="width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;" valign="top"><![endif]-->                <div class="u-col u-col-100" style="max-width: 320px;min-width: 600px;display: table-cell;vertical-align: top;">                  <div style="height: 100%;width: 100% !important;">                    <!--[if (!mso)&(!IE)]><!-->                    <div style="height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;">                      <!--<![endif]-->                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:41px 55px 18px;font-family:'Cabin',sans-serif;" align="left">                              <div style="color: #003399; line-height: 160%; text-align: center; word-wrap: break-word;">                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 20px; line-height: 32px;"><strong>You are receiving this email from official email address of Whatsaf (no-reply@whatsaf.in).</strong></span></p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;">whatsaf.in</span></p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;"><a rel="noopener" href="mailto:contact@whatsaf.in" target="_blank">contact@whatsaf.in</a></span></p>                                <p style="font-size: 14px; line-height: 160%;"> </p>                                <p style="font-size: 14px; line-height: 160%;"><span style="font-size: 16px; line-height: 25.6px; color: #000000;"><a rel="noopener" href="https://whatsaf.in/unsubscribe/'''+request.user.email+'''" target="_blank">Unsubscribe</a> | <a rel="noopener" href="https://whatsaf.in/blogs/" target="_blank">Blogs</a> | <a rel="noopener" href="https://whatsaf.in" target="_blank">Visit Website</a></span></p>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <table style="font-family:'Cabin',sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">                        <tbody>                          <tr>                            <td style="overflow-wrap:break-word;word-break:break-word;padding:10px 10px 33px;font-family:'Cabin',sans-serif;" align="left">                              <div align="center">                                <div style="display: table; max-width:244px;">                                  <!--[if (mso)|(IE)]><table width="244" cellpadding="0" cellspacing="0" border="0"><tr><td style="border-collapse:collapse;" align="center"><table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-collapse:collapse; mso-table-lspace: 0pt;mso-table-rspace: 0pt; width:244px;"><tr><![endif]-->                                  <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                  <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                    <tbody>                                      <tr style="vertical-align: top">                                        <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                          <a href="" title="LinkedIn" target="_blank">                                            <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/linkedin.png" alt="LinkedIn" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                          </a>                                        </td>                                      </tr>                                    </tbody>                                  </table>                                  <!--[if (mso)|(IE)]></td><![endif]-->                                  <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                    <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                        <tbody>                                          <tr style="vertical-align: top">                                            <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                              <a href="" title="LinkedIn" target="_blank">                                                <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/youtube.png" alt="YouTube" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                              </a>                                            </td>                                          </tr>                                        </tbody>                                      </table>                                      <!--[if (mso)|(IE)]></td><![endif]-->                                      <!--[if (mso)|(IE)]><td width="32" style="width:32px; padding-right: 17px;" valign="top"><![endif]-->                                  <table align="left" border="0" cellspacing="0" cellpadding="0" width="32" height="32" style="width: 32px !important;height: 32px !important;display: inline-block;border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;margin-right: 17px">                                    <tbody>                                      <tr style="vertical-align: top">                                        <td align="left" valign="middle" style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">                                          <a href="" title="LinkedIn" target="_blank">                                            <img src="https://cdn.tools.unlayer.com/social/icons/circle-black/x.png" alt="X" title="LinkedIn" width="32" style="outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block !important;border: none;height: auto;float: none;max-width: 32px !important">                                          </a>                                        </td>                                      </tr>                                    </tbody>                                  </table>                                  <!--[if (mso)|(IE)]></td><![endif]-->                                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->                                </div>                              </div>                            </td>                          </tr>                        </tbody>                      </table>                      <!--[if (!mso)&(!IE)]><!-->                    </div>                    <!--<![endif]-->                  </div>                </div>                <!--[if (mso)|(IE)]></td><![endif]-->                <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->              </div>            </div>          </div>          <!--[if (mso)|(IE)]></td></tr></table><![endif]-->        </td>      </tr>    </tbody>  </table>  <!--[if mso]></div><![endif]-->  <!--[if IE]></div><![endif]--></body></html>''')
            messages.success(request, "Your profile has been updated.")
        else:
            messages.warning(request, "Incorrect password.")
        return redirect("UserProfile")
    return redirect("ErrorPage") 

def DeleteAccount(request):
    if request.method == "POST":
        pwd = request.POST["password"]
        if check_password(pwd, request.user.password):
            userdet = User.objects.get(username=request.user.username)
            sendEmail(request.user.email, "Account Deleted", "We're sorry to see you go and would appreciate any feedback you might have about your experience with us. Your insights are valuable and can help us improve our services for future users. If there's anything specific that led to your decision to delete your account, please feel free to share it with us.")
            userdet.delete()
            messages.success(request, "We are really feeling very bad to see you go.")
            return redirect("HomePage")
        else:
            messages.warning(request, "Incorrect password.")
            return redirect("UserProfile")
    return redirect("ErrorPage")

def ChangePassword(request):
    if request.method == "POST":
        oldpass = request.POST["oldpass"]
        newpass = request.POST["newpass"]
        confpass = request.POST["confpass"]
        if newpass != confpass:
            messages.warning(request, "Passwords Unmatched.")
            return redirect("UserProfile")
        if check_password(oldpass, request.user.password):
            userdet = User.objects.get(username=request.user)
            userdet.set_password(newpass)
            userdet.save()
            userDet = User.objects.get(username=request.user)
            authLogin(request, userDet)
            sendEmail(request.user.email, "Password Updated!", "<h6>Your password for your Whatsaf account has been successfully updated. Your account security is paramount to us, and we appreciate your proactive step in ensuring the safety of your information.</h6>")
            messages.success(request, "Your password has been changed successfully.")
        else:
            messages.warning(request, "Incorrect password.")
        return redirect("UserProfile")
    return redirect("ErrorPage")

def TermsConditions(request):
    return render(request, "tc.html")

def userview(request, slug):
    if User.objects.filter(username = slug).exists() == False:
        return render(request, "user-view.html")
    user = User.objects.get(username = slug)
    userdet = UserDetail.objects.get(User = user)
    return render(request, "user-view.html", {"data" : userdet, "user" : user})

def unsubscribe(request, em):
    return redirect("HomePage")

